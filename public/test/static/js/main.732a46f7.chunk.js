(this.webpackJsonptagging_interface=this.webpackJsonptagging_interface||[]).push([[0],{16:function(e,t){e.exports="data:image/png;base64,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"},21:function(e,t,n){e.exports=n(36)},26:function(e,t,n){},27:function(e,t,n){e.exports=n.p+"static/media/redcoat-1-threshold.78b878cf.png"},28:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(6),o=n.n(s),r=(n(26),n(8)),c=n(20),l=n(1),d=n(2),u=n(4),p=n(3),h=n(16),m=n.n(h),g=(n(27),n(28),n(5)),f=n.n(g),v=n(9),y=n(14),k=(n(29),n(17)),b=n(18),S=n.n(b),E=n(30);function w(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}var x=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return i.a.createElement("nav",{id:"navbar"},i.a.createElement("div",{className:"navbar-left"},i.a.createElement("div",{id:"logo"},i.a.createElement("a",{href:"/redcoat"},i.a.createElement("span",{className:"inner"},i.a.createElement("span",{className:"img"},i.a.createElement("img",{src:m.a})),i.a.createElement("span",null,"Redcoat"))))),i.a.createElement("div",{className:"navbar-centre"},this.props.pageTitle),i.a.createElement("div",{className:"navbar-right"},i.a.createElement("div",{className:"dropdown-menu short"},i.a.createElement("a",{href:"features"},"v1.0"))))}}]),n}(a.Component),C=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){return Object(l.a)(this,n),t.call(this,e)}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.props.item,a=this.props.index,s=this.props.item.children;if(s)var o=i.a.createElement("ul",{className:this.props.open?"":"hidden"},s.map((function(t,a){return i.a.createElement(n,{key:a,item:t,open:e.props.openedItems.has(t.full_name),openedItems:e.props.openedItems,onClick:e.props.onClick,hotkeyMap:e.props.hotkeyMap,hotkeyChain:e.props.hotkeyChain,isTopLevelCategory:!1,applyTag:e.props.applyTag})})));else o="";var r=this.props.hotkeyMap.hasOwnProperty(this.props.item.full_name),c=r?this.props.hotkeyMap[this.props.item.full_name].join(""):"",l=i.a.createElement("span",{className:"inner-container"},s&&i.a.createElement("span",{className:"open-button",onClick:function(){return e.props.onClick(t.full_name)}},i.a.createElement("i",{className:"fa fa-chevron-"+(this.props.open?"up":"down")})),i.a.createElement("span",{className:"category-name"+(r?" has-hotkey":"")+(this.props.hotkeyChain===c?" hotkey-active":""),"data-hotkey-id":c,onClick:function(){return e.props.applyTag(e.props.item.full_name)}},t.name));return this.props.isTopLevelCategory?i.a.createElement(v.b,{key:t.id.toString(),draggableId:t.id.toString(),index:a},(function(e,n){return i.a.createElement("li",Object.assign({ref:e.innerRef},e.draggableProps,{className:"draggable "+(n.isDragging?"dragging":"not-dragging")+" color-"+(t.colorId+1)}),i.a.createElement("div",Object.assign({},e.dragHandleProps,{className:"drag-handle-container"}),i.a.createElement("span",{className:"drag-handle"})),l,o)})):i.a.createElement("li",null,l,o)}}]),n}(a.Component);var I=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={itemOrder:[],orderedItems:[],openedItems:new Set},a.onDragEnd=a.onDragEnd.bind(Object(r.a)(a)),a}return Object(d.a)(n,[{key:"componentDidUpdate",value:function(e,t){var n=this;var a=function(){for(var e=new Array(n.props.items.length),t=0;t<e.length;t++)e[t]=t;return e}();y.a.isEqual(e.items,this.props.items)||this.setState({openedItems:new Set,orderedItems:this.props.items,itemOrder:a})}},{key:"toggleCategory",value:function(e){var t=this.state.openedItems;t.has(e)?t.delete(e):t.add(e),this.setState({openedItems:t})}},{key:"onDragEnd",value:function(e){var t=this;if(e.destination){var n=function(e,t,n){var a=Array.from(e),i=a.splice(t,1),s=Object(c.a)(i,1)[0];return a.splice(n,0,s),a}(this.state.itemOrder,e.source.index,e.destination.index),a=function(e,t){for(var n=new Array(e.length),a=0;a<t.length;a++)n[a]=e[t[a]];return n}(this.props.items,n);this.props.initHotkeyMap(a,(function(){return t.setState({itemOrder:n,orderedItems:a})}))}}},{key:"render",value:function(){var e=this,t=this.state.orderedItems,n=this.state.openedItems;return i.a.createElement("div",{id:"category-hierarchy-tree"},i.a.createElement(v.a,{onDragEnd:this.onDragEnd},i.a.createElement(v.c,{droppableId:"droppable"},(function(a,s){return i.a.createElement("ul",Object.assign({},a.droppableProps,{className:"draggable-list"+(s.isDraggingOver?" dragging":""),ref:a.innerRef}),t.map((function(t,a){return i.a.createElement(C,{key:a,item:t,index:a,onClick:e.toggleCategory.bind(e),open:n.has(t.name),openedItems:e.state.openedItems,hotkeyMap:e.props.hotkeyMap,hotkeyChain:e.props.hotkeyChain,isTopLevelCategory:!0,applyTag:e.props.applyTag})})),a.placeholder)}))))}}]),n}(a.Component);function N(e,t){return t[e.split("/").slice(0,1)[0]]}var A=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){return Object(l.a)(this,n),t.call(this,e)}return Object(d.a)(n,[{key:"render",value:function(){var e=this;return i.a.createElement("span",{className:"label tag-"+this.props.colourIdx,onClick:function(t){e.props.deleteTag(e.props.entityClass)}},i.a.createElement("span",{className:"label-name"},this.props.entityClass))}}]),n}(a.Component),j=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={selected:!1},a}return Object(d.a)(n,[{key:"deleteTag",value:function(e){this.props.deleteTag(this.props.index,e)}},{key:"render",value:function(){var e=this,t=this.props.annotation.hasLabel(),n=t?" tag "+("B"===this.props.annotation.bioTag?"tag-begin":"")+(this.props.annotation.isLastInSpan()?" tag-end":""):"";if(t)var a=this.props.annotation.entityClasses.map((function(t,n){return i.a.createElement(A,{deleteTag:e.deleteTag.bind(e),key:n,bioTag:e.props.annotation.bioTag,entityClass:t,colourIdx:N(t,e.props.entityColourMap)})}));else a="";return i.a.createElement("span",{className:"word"+(this.props.selected?" selected":"")+n},i.a.createElement("span",{className:"word-inner",onMouseUp:function(){return e.props.updateSelections(e.props.index,"up")},onMouseDown:function(){return e.props.updateSelections(e.props.index,"down")}},this.props.text),a)}}]),n}(a.Component),O=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){return Object(l.a)(this,n),t.call(this,e)}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.props.docIdx,n=this.props.value;return i.a.createElement("span",{className:"confidence-button conf-"+n+(this.props.checked?" checked":""),onClick:function(){return e.props.updateConfidence(t,n)},title:"Assign a "+n+" confidence to this document."})}}]),n}(a.Component),T=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){return Object(l.a)(this,n),t.call(this,e)}return Object(d.a)(n,[{key:"render",value:function(){return i.a.createElement("div",{className:"confidence-buttons"},i.a.createElement(O,Object.assign({value:"low",checked:"low"===this.props.confidence},this.props)),i.a.createElement(O,Object.assign({value:"medium",checked:"medium"===this.props.confidence},this.props)),i.a.createElement(O,Object.assign({value:"high",checked:"high"===this.props.confidence},this.props)))}}]),n}(a.Component),M=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){return Object(l.a)(this,n),t.call(this,e)}return Object(d.a)(n,[{key:"render",value:function(){return i.a.createElement("div",{className:"document-container"+(this.props.confidence?" conf conf-"+this.props.confidence:"")},i.a.createElement("div",{className:"document"},i.a.createElement("div",{className:"sentence-index"},i.a.createElement("span",{className:"inner"},this.props.displayIndex)),i.a.createElement(G,{index:this.props.index,words:this.props.words,annotations:this.props.annotations,selections:this.props.selections,updateSelections:this.props.updateSelections,entityColourMap:this.props.entityColourMap,deleteTag:this.props.deleteTag}),i.a.createElement(T,{docIdx:this.props.index,confidence:this.props.confidence,updateConfidence:this.props.updateConfidence})))}}]),n}(a.Component),G=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){return Object(l.a)(this,n),t.call(this,e)}return Object(d.a)(n,[{key:"updateSelections",value:function(e,t){this.props.updateSelections(this.props.index,e,t)}},{key:"deleteTag",value:function(e,t){this.props.deleteTag(this.props.index,e,t)}},{key:"saveToPng",value:function(){var e=this,t=f()("#sentence-tagging .sentence")[this.props.index+1];S.a.toBlob(t,{filter:function(e){return e.classList?!e.classList.contains("save-to-png"):e},bgcolor:"#fefefe"}).then((function(t){Object(k.saveAs)(t,"document-"+e.props.index+".png")}))}},{key:"render",value:function(){var e=this,t=this.props.selections;function n(e){if(0===t.length)return!1;for(var n=0;n<t.length;n++){var a=t[n];if(!(a.wordEndIndex<0)&&(a.wordEndIndex>=e&&e>=a.wordStartIndex))return!0}return!1}return i.a.createElement("div",{className:"sentence"},this.props.words.map((function(t,a){return i.a.createElement(j,{key:a,index:a,text:t,selected:n(a),annotation:e.props.annotations[a],updateSelections:e.updateSelections.bind(e),entityColourMap:e.props.entityColourMap,deleteTag:e.deleteTag.bind(e)})})),i.a.createElement("div",{className:"save-to-png",onClick:this.saveToPng.bind(this),title:"Click to download a .png file of this document"},i.a.createElement("i",{className:"fa fa-download"})))}}]),n}(a.Component);function P(e){if(e.hasChildNodes())return e.firstChild;for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null}var q=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){return Object(l.a)(this,n),t.call(this,e)}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props.entityClass;return void 0===e&&(e="(not a valid class)"),i.a.createElement("div",{className:"hotkey-info"+(0===this.props.chain.length?" hidden":"")},i.a.createElement("span",{className:"chain"},this.props.chain),": ",i.a.createElement("span",null,e))}}]),n}(a.Component),L=function(){function e(t,n){Object(l.a)(this,e),this.token=t,this.tokenIndex=n,this.bioTag="O"}return Object(d.a)(e,[{key:"addLabel",value:function(e,t,n,a,i){void 0===this.entityClasses&&(this.entityClasses=new Array);var s=-1!==this.entityClasses.indexOf(t);return(this.bioTag!==e||this.spanText!==n||this.spanStartIdx!==a||this.spanEndIdx!==i||!s)&&(this.bioTag=e,this.spanText=n,this.spanStartIdx=a,this.spanEndIdx=i,s||this.entityClasses.push(t),!0)}},{key:"removeAllLabels",value:function(){delete this.entityClasses,delete this.spanText,delete this.spanStartIdx,delete this.spanEndIdx,this.bioTag="O"}},{key:"sameMention",value:function(e){return e.spanStartIdx===this.spanStartIdx&&e.spanEndIdx===this.spanEndIdx}},{key:"sameEntityClasses",value:function(e){return y.a.isEqual(this.entityClasses,e.entityClasses)}},{key:"removeLabel",value:function(e){var t=this.entityClasses.indexOf(e);-1!==t?(this.entityClasses.splice(t,1),0===this.entityClasses.length&&(this.bioTag="O",delete this.entityClasses,delete this.spanText,delete this.spanStartIdx,delete this.spanEndIdx)):console.log("Warning: tried to remove an entity class from an annotation that did not exist.")}},{key:"changeBioTag",value:function(e){this.bioTag=e}},{key:"hasLabel",value:function(){return"O"!==this.bioTag}},{key:"isLastInSpan",value:function(){return this.spanEndIdx===this.tokenIndex}},{key:"setSpanStartIdx",value:function(e){this.spanStartIdx=e}},{key:"setSpanEndIdx",value:function(e){this.spanEndIdx=e}},{key:"prettyPrint",value:function(){console.log("Token:    ",this.token),console.log("BIO Tag:  ",this.bioTag),console.log("Span:     ",this.spanText),console.log("StartIdx: ",this.spanStartIdx),console.log("EndIdx: ",this.spanEndIdx),console.log("Classes:  \n",this.entityClasses),console.log("\n")}}]),e}();var U=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={visible:!0,querying:!1,wikipediaSummary:null,wikipediaReadMoreUrl:null},a}return Object(d.a)(n,[{key:"queryWikipedia",value:function(){var e=this,t=this.props.tokens;this.setState({querying:!0},(function(){var n,a,i,s=e;i=function(e,i,o){var r=t;i?(e.toLowerCase()!==t.toLowerCase()&&(r=e),n=i+"...",a=o):(a=null,n=null),s.setState({wikipediaTitle:r,wikipediaSummary:n,wikipediaReadMoreUrl:a,querying:!1})},f.a.ajax({url:"https://en.wikipedia.org/w/api.php",data:{action:"query",list:"search",srsearch:t,format:"json"},dataType:"jsonp",success:function(e){!function(e,t){try{t(e.query.search[0].title,e.query.search[0].snippet.replace(/<\/?[^>]+(>|$)/g,""),"https://en.wikipedia.org/wiki/"+e.query.search[0].title.replace(/ /g,"_"))}catch(n){t()}}(e,i)}})}))}},{key:"toggleVisibility",value:function(){this.setState({visible:!this.state.visible})}},{key:"componentDidUpdate",value:function(e,t){e.tokens!==this.props.tokens&&this.queryWikipedia()}},{key:"render",value:function(){if(!this.state.querying&&this.state.wikipediaTitle&&this.state.wikipediaTitle!==this.props.tokens)var e=i.a.createElement("span",{className:"different"},"[",this.state.wikipediaTitle,"] ");else e="";var t=this.state.wikipediaSummary?this.state.wikipediaSummary:"(no Wikipedia entry)";return this.props.tokens||(t="Select one or more words to automatically look them up on Wikipedia."),this.state.querying&&(t=i.a.createElement("span",null,i.a.createElement("i",{className:"fa fa-spin fa-cog"}),"\xa0\xa0Loading...")),i.a.createElement("div",{className:"tokens-info"},i.a.createElement("div",{id:"wikipedia-summary-container",className:this.state.visible?"show":"hidden"},i.a.createElement("p",{className:"tokens"},this.props.tokens||"Wikipedia lookup"),i.a.createElement("p",{className:"summary"},e,t),i.a.createElement("span",{className:"more show"},(this.state.querying||!this.props.tokens)&&i.a.createElement("span",{className:"left",style:{color:"rgba(0, 0, 0, 0)"}},"."),!this.state.querying&&this.props.tokens&&i.a.createElement("span",{className:"left"},"Results from Wikipedia"),i.a.createElement("span",{className:"right"},!this.state.querying&&this.props.tokens&&i.a.createElement("a",{id:"ec-read-more",href:this.state.wikipediaReadMoreUrl,target:"_blank"},"Read more ",i.a.createElement("i",{className:"fa fa-sm fa-external-link"}))))),i.a.createElement("button",{id:"wikipedia-hide-show",className:this.state.visible?"up":"down",onClick:this.toggleVisibility.bind(this)},"Show"))}}]),n}(a.Component),D=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={project_id:"RtJp98vxk",data:{documentGroup:[],categoryHierarchy:{children:[]},pageNumber:-1,annotatedDocGroups:-1},documentGroupAnnotationId:null,annotations:[],confidences:[],selections:a.getEmptySelectionsArray(10),currentSelection:a.getEmptyCurrentSelection(),mostRecentSelectionText:null,hotkeyMap:{},reverseHotkeyMap:{},hotkeyChain:[],hotkeyBindingFn:null,hotkeyTimeoutFn:null,holdingCtrl:!1,holdingShift:!1,entityColourMap:{},docGroupLastModified:null,pageNumber:-1,totalPages:-1,changesMade:!1,recentlySaved:!1,selectionChangeFn:null,windowMouseUpFn:null,loading:{querying:!0,saving:!1,firstLoad:!0},showingProgressBar:!1,taggingCompletePage:!1},a}return Object(d.a)(n,[{key:"selectionChange",value:function(e,t){if(!(this.state.currentSelection.wordStartIndex<0)){var n=window.getSelection&&window.getSelection();if(n&&n.rangeCount>0){var a=function(e){var t=e.startContainer,n=e.endContainer;if(t==n)return[t.parentNode];for(var a=[];t&&t!=n;)a.push(t=P(t));for(t=e.startContainer;t&&t!=e.commonAncestorContainer;)a.unshift(t),t=t.parentNode;return a}(n.getRangeAt(0));t.removeClass("highlighted"),f()(a).find(".word-inner").addClass("highlighted")}}}},{key:"windowMouseUp",value:function(e,t){if(t.removeClass("highlighted"),this.state.currentSelection.wordStartIndex<0)w();else if(!e.target.classList.contains("word-inner")){var n=this.state.currentSelection.sentenceIndex;this.updateSelections(n,this.state.data.documentGroup[n].length-1,"up")}}},{key:"initMouseEvents",value:function(){var e=this,t=f()(".word-inner");document.removeEventListener("selectionchange",this.state.selectionChangeFn),window.removeEventListener("mouseup",this.state.windowMouseUpFn),this.setState({selectionChangeFn:function(n){return e.selectionChange(n,t)},windowMouseUpFn:function(n){return e.windowMouseUp(n,t)}},(function(){document.addEventListener("selectionchange",e.state.selectionChangeFn),window.addEventListener("mouseup",e.state.windowMouseUpFn)}))}},{key:"initKeybinds",value:function(){var e=this;document.addEventListener("keydown",(function(t){switch(t.key){case"Shift":e.state.holdingShift||e.setState({holdingShift:!0});break;case"Control":e.state.holdingCtrl||e.setState({holdingCtrl:!0});break;case"ArrowLeft":t.preventDefault(),e.moveSelectionHorizontally("left");break;case"ArrowUp":t.preventDefault(),e.moveSelectionVertically("up");break;case"ArrowRight":t.preventDefault(),e.moveSelectionHorizontally("right");break;case"ArrowDown":t.preventDefault(),e.moveSelectionVertically("down")}})),document.addEventListener("keyup",(function(t){switch(t.key){case"Shift":e.state.holdingShift&&e.setState({holdingShift:!1});break;case"Control":e.state.holdingCtrl&&e.setState({holdingCtrl:!1})}}))}},{key:"hotkeyTimeout",value:function(){var e=this.state.hotkeyChain.join(""),t=this.state.reverseHotkeyMap[e];void 0!==t&&this.applyTag(t),window.clearTimeout(this.state.hotkeyTimeoutFn),this.setState({hotkeyTimeoutFn:null,hotkeyChain:[]})}},{key:"bindHotkeys",value:function(e,t){var n=this;if(!(e.keyCode<49||e.keyCode>57)){var a=e.keyCode-48,i=Array.prototype.concat(this.state.hotkeyChain,a);this.setState({hotkeyChain:i},(function(){window.clearTimeout(n.state.hotkeyTimeoutFn);var e=window.setTimeout((function(){return n.hotkeyTimeout()}),333);n.setState({hotkeyTimeoutFn:e})}))}}},{key:"setupHotkeyKeybinds",value:function(){var e=this;console.log("Setting up hotkey keybinds..."),document.removeEventListener("keydown",this.state.hotkeyBindingFn);var t=function(t){return e.bindHotkeys(t,e.state.hotkeyMap)};document.addEventListener("keydown",t),this.setState({hotkeyBindingFn:t})}},{key:"initHotkeyMap",value:function(e,t){var n=this;console.log("Setting up hotkey map...");var a=function e(t,n,a,i,s){if(s||(a[t.full_name]=i),t.children)for(var o=0;o<Math.min(9,t.children.length);o++)e(t.children[o],o+1,a,Array.prototype.concat(i,o+1));return a}({children:e},0,[],[],!0),i=function(e){var t={};for(var n in e){t[e[n].join("")]=n}return t}(a);this.setState({hotkeyMap:a,reverseHotkeyMap:i},(function(){n.setupHotkeyKeybinds(),t&&t()}))}},{key:"initAnnotationsArray",value:function(e,t){var n=new Array(e.length);for(var a in e)for(var i in n[a]=new Array(e[a].length),e[a])n[a][i]=new L(e[a][i],parseInt(i));if(!t)return n;for(var a in t)for(var s in t[a].mentions){var o=t[a].mentions[s],r=o.start,c=o.end;for(var l in o.labels)for(var d=o.labels[l],u=r;u<c;u++){var p=u===r?"B":"I";n[a][u].addLabel(p,d,e[a].slice(r,c).join(" "),r,c-1)}}return n}},{key:"initConfidencesArray",value:function(e){return new Array(e.length)}},{key:"initEntityColourMap",value:function(e){var t={};for(var n in e){var a=e[n];t[a.name]=a.colorId+1}return t}},{key:"justifyWords",value:function(){f()(".word-inner").each((function(e,t){var n=t.offsetWidth,a=25*Math.ceil(n/25);f()(t).css("min-width",a+"px")}))}},{key:"clearWordJustification",value:function(){f()(".word:not(.tag) .word-inner").each((function(e,t){f()(t).css("min-width","auto")}))}},{key:"loadNextPage",value:function(){var e=this.state.pageNumber+1;e===this.state.totalPages?this.queryAPI(!1):this.queryAPI(!1,e)}},{key:"loadPreviousPage",value:function(){this.queryAPI(!1,this.state.pageNumber-1)}},{key:"queryAPI",value:function(e,t){var n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}},a="getDocumentGroup";t&&(a="getPreviouslyAnnotatedDocumentGroup?pageNumber="+t),this.setState({loading:{querying:!0,saving:!1,firstLoad:e}},function(){var t=this;fetch("http://localhost:3000/projects/"+this.state.project_id+"/tagging/"+a,n).then((function(e){return e.text()})).then((function(n){try{var a=JSON.parse(n)}catch(i){return void alert(i)}if(a.tagging_complete)return console.log(a),void t.setState({taggingCompletePage:!0,totalPages:a.annotatedDocGroups+1,pageNumber:a.annotatedDocGroups+1,changesMade:!1,recentlySaved:!1,loading:{querying:!1,saving:!1},data:{projectName:a.projectName,documentGroup:[],categoryHierarchy:{children:[]},pageNumber:-1,annotatedDocGroups:-1}});t.setState({data:a,entityColourMap:t.initEntityColourMap(a.categoryHierarchy.children),confidences:t.initConfidencesArray(a.documentGroup),annotations:t.initAnnotationsArray(a.documentGroup,a.automaticAnnotations),selections:t.getEmptySelectionsArray(a.documentGroup.length),mostRecentSelectionText:null,pageNumber:a.pageNumber,totalPages:a.annotatedDocGroups+1,docGroupLastModified:a.lastModified,documentGroupAnnotationId:a.documentGroupAnnotationId,changesMade:!1,recentlySaved:!1,loading:{querying:!1,saving:!1},taggingCompletePage:!1},(function(){console.log("Data:",t.state.data),e&&(t.initKeybinds(),t.initHotkeyMap(t.state.data.categoryHierarchy.children)),t.initMouseEvents(),t.clearWordJustification(),t.justifyWords(),t.selectFirstWord(),window.scrollTo(0,0)}))}))}.bind(this))}},{key:"annotationsToJSON",value:function(){var e=this.state.annotations,t=[];for(var n in e){var a=[];for(var i in e[n]){var s=e[n][i];s.entityClasses?a.push([s.bioTag+"-",s.entityClasses]):a.push([""])}t.push(a)}return t}},{key:"submitAnnotations",value:function(){var e=this;if(!this.state.recentlySaved){var t=function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),a=0;a<n.length;a++){var i=n[a].trim();if(i.substring(0,e.length+1)===e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}return t}("csrf-token"),n=this.annotationsToJSON(),a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","csrf-token":t},dataType:"json",body:JSON.stringify({documentGroupId:this.state.data.documentGroupId,documentGroupAnnotationId:this.state.documentGroupAnnotationId,labels:n})};fetch("http://localhost:3000/projects/"+this.state.project_id+"/tagging/submitAnnotations",a).then((function(e){return e.text()})).then((function(t){try{var n=JSON.parse(t);console.log(n);var a=n.documentGroupAnnotationId;if(console.log("Submitted annotations OK"),e.state.pageNumber===e.state.totalPages){var i=e.state.totalPages+1;e.setState({showingProgressBar:!0},(function(){window.setTimeout((function(){return e.setState({showingProgressBar:!1})}),3e3)}))}else i=e.state.totalPages;e.setState({docGroupLastModified:Date.now(),totalPages:i,changesMade:!1,recentlySaved:!0,documentGroupAnnotationId:a})}catch(s){console.log(s),alert(t)}}))}}},{key:"componentWillMount",value:function(){var e=this,t=window.location.pathname,n=t.split("/")[2];if("/"===t)n="RtJp98vxk";n&&9===n.length?this.setState({project_id:n},(function(){e.queryAPI(!0)})):alert("invalid project")}},{key:"getEmptyCurrentSelection",value:function(){return{wordStartIndex:-1,wordEndIndex:-1,sentenceIndex:-1}}},{key:"moveSelectionVertically",value:function(e){console.log("Moving",e)}},{key:"moveSelectionHorizontally",value:function(e){console.log("Moving",e);for(var t,n=this.state.selections,a=0;a<n.length;a++)for(var i=0;i<n[a].length;i++){var s=n[a][i];"left"===e?this.state.holdingShift?s.wordEndIndex>s.wordStartIndex?s.wordEndIndex--:s.wordStartIndex=Math.max(s.wordStartIndex-1,0):(s.wordStartIndex=Math.max(s.wordStartIndex-1,0),s.wordEndIndex=s.wordStartIndex):"right"===e&&(this.state.holdingShift||(s.wordStartIndex=Math.min(this.state.data.documentGroup[a].length-1,s.wordEndIndex+1)),s.wordEndIndex=Math.min(this.state.data.documentGroup[a].length-1,s.wordEndIndex+1)),t=this.state.data.documentGroup[a].slice(s.wordStartIndex,s.wordEndIndex+1).join(" ")}this.setState({selections:n,mostRecentSelectionText:t})}},{key:"getEmptySelectionsArray",value:function(e){if(!e)e=this.state.data.documentGroup.length;for(var t=new Array(e),n=0;n<t.length;n++)t[n]=new Array;return t}},{key:"selectFirstWord",value:function(){var e=this.state.selections;e[0].push({wordStartIndex:0,wordEndIndex:0}),this.setState({selections:e,mostRecentSelectionText:this.state.data.documentGroup[0][0]})}},{key:"clearSelections",value:function(){this.setState({currentSelection:this.getEmptyCurrentSelection(),selections:this.getEmptySelectionsArray()})}},{key:"updateSelections",value:function(e,t,n){var a,i,s=this.state.selections,o=this.state.currentSelection;if("down"===n)this.state.holdingCtrl||(s=this.getEmptySelectionsArray()),i=-1,o={sentenceIndex:e,wordStartIndex:a=t};else if("up"===n){if(-1===o.wordStartIndex)return void this.clearSelections();if(a=o.wordStartIndex,o.sentenceIndex!==e&&(a=0),i=t,t<a){var r=a;a=t,i=r}o=this.getEmptyCurrentSelection(),s[e].push({wordStartIndex:a,wordEndIndex:i});var c=this.state.data.documentGroup[e].slice(a,i+1).join(" ");w()}this.setState({currentSelection:o,selections:s,mostRecentSelectionText:c||this.state.mostRecentSelectionText})}},{key:"applyTag",value:function(e){var t=this,n=this.state.selections,a=this.state.data.documentGroup,i=this.state.annotations;for(var s in n)for(var o in n[s]){for(var r=n[s][o],c=r.wordStartIndex,l=r.wordEndIndex,d=i[s][c].spanStartIdx,u=i[s][c].spanEndIdx,p=!1,h=c+1;h<=l;h++){var m=i[s][h];if(d!==m.spanStartIdx||u!==m.spanEndIdx){p=!0;break}}if(p){for(h=c;h<=l;h++){(v=i[s][h]).removeAllLabels()}for(var g in i[s]){(v=i[s][g]).spanEndIdx>=c&&v.spanStartIdx<=c&&v.setSpanEndIdx(c-1),v.spanStartIdx<=l&&(v.setSpanStartIdx(l+1),v.tokenIndex===l+1&&v.changeBioTag("B"))}}for(var f in i[s].slice(0,c)){(v=i[s][f]).spanStartIdx<c&&v.spanEndIdx>=l&&v.setSpanEndIdx(c-1)}for(var f in i[s].slice(l+1,i[s].length)){var v;(v=i[s][parseInt(f)+l+1]).spanStartIdx<=c&&v.spanEndIdx>=l&&(v.setSpanStartIdx(l+1),"0"===f&&v.changeBioTag("B"))}var y=!1;for(h=c;h<=l;h++){var k=h===c?"B":"I",b=a[s].slice(c,l+1).join(" ");y=i[s][h].addLabel(k,e,b,c,l)}y&&this.captureEvent("Applied label",parseInt(s),c,l,e)}this.setState({annotations:i},(function(){t.justifyWords()}))}},{key:"deleteTag",value:function(e,t,n){var a=this.state.annotations,i=a[e][t],s=i.spanStartIdx,o=i.spanEndIdx;for(var r in this.captureEvent("Deleted label",e,s,o,n),a[e]){var c=a[e][r];c.spanStartIdx===s&&c.spanEndIdx===o&&c.removeLabel(n)}this.setState({annotations:a})}},{key:"updateConfidence",value:function(e,t){var n=this.state.confidences;n[e]===t?n[e]=void 0:n[e]=t,this.setState({confidences:n})}},{key:"captureEvent",value:function(e,t,n,a,i){var s={action:e,sentenceIndex:t,wordIndex:{start:n,end:a},entityClass:i,tokenString:this.state.data.documentGroup[t].slice(n,a+1).join(" ")};console.log(s),"Applied label"!==e&&"Deleted label"!==e||this.setState({changesMade:!0,recentlySaved:!1})}},{key:"render",value:function(){var e=this,t=this.state.taggingCompletePage,n=i.a.createElement("span",{className:"group-name"+(this.state.showingProgressBar?" progress-bar-underneath":"")},i.a.createElement("span",null,"Group ",i.a.createElement("b",null,this.state.pageNumber)," of ",i.a.createElement("b",null,this.state.data.docGroupsPerUser))),a=this.state.totalPages===this.state.pageNumber,s=this.state.docGroupLastModified?"Saved on "+E(this.state.docGroupLastModified,"dd mmm")+" at "+E(this.state.docGroupLastModified,"h:MM tt"):this.state.changesMade?"Changes not saved":"",o=i.a.createElement("button",{className:"save-button"+(this.state.changesMade?"":this.state.recentlySaved?" recently-saved":" disabled"),onClick:this.submitAnnotations.bind(this)},i.a.createElement("i",{className:"fa fa-"+(this.state.recentlySaved?"check":"save")}),this.state.recentlySaved?"Saved":"Save"),r=i.a.createElement("div",{id:"tagging-progress-bar",className:this.state.showingProgressBar?"show":"hide"},i.a.createElement("span",{className:"progress-bar"},i.a.createElement("span",{className:"inner",style:{width:this.state.totalPages/this.state.data.docGroupsPerUser*100+"%"}})));return i.a.createElement("div",{id:"app"},i.a.createElement(x,{pageTitle:"Annotating project: "+this.state.data.projectName}),i.a.createElement("div",{id:"tagging-interface",className:(this.state.loading.querying?"loading":"")+(this.state.taggingCompletePage?" tagging-complete-page":"")},i.a.createElement("div",{id:"tagging-container"},t&&i.a.createElement(R,null),i.a.createElement("div",{id:"sentence-tagging"},this.state.loading.firstLoad&&i.a.createElement("div",{className:"loading-message"},i.a.createElement("i",{className:"fa fa-cog fa-spin"}),"Loading..."),i.a.createElement("div",{id:"pagination"},i.a.createElement("div",{className:"page-button-container previous-page"},i.a.createElement("button",{className:1===this.state.pageNumber?" disabled":"",onClick:this.loadPreviousPage.bind(this)},i.a.createElement("i",{className:"fa fa-chevron-left"}),"Prev")),i.a.createElement("div",{className:"filler-left"}),i.a.createElement("div",{className:"current-page-container"},n,r),i.a.createElement("div",{className:"group-last-modified"},s),i.a.createElement("div",{className:"page-button-container "},o),i.a.createElement("div",{className:"page-button-container next-page"},i.a.createElement("button",{className:a?" disabled":"",onClick:this.loadNextPage.bind(this)},"Next",i.a.createElement("i",{className:"fa fa-chevron-right"})))),i.a.createElement("div",{className:"document-container header"},i.a.createElement("div",{className:"document header"},i.a.createElement("div",{className:"sentence-index"}),i.a.createElement("div",{className:"sentence"},"Document"),i.a.createElement("div",{className:"confidence-buttons"},"Confidence"))),this.state.data.documentGroup.map((function(t,n){return i.a.createElement(M,{key:n,index:n,displayIndex:10*(e.state.pageNumber-1)+n+1,words:t,annotations:e.state.annotations[n],confidence:e.state.confidences[n],selections:e.state.selections[n],updateSelections:e.updateSelections.bind(e),updateConfidence:e.updateConfidence.bind(e),entityColourMap:e.state.entityColourMap,deleteTag:e.deleteTag.bind(e)})})))),i.a.createElement("div",{id:"tagging-menu"},i.a.createElement(U,{tokens:this.state.mostRecentSelectionText}),i.a.createElement(q,{chain:this.state.hotkeyChain,entityClass:this.state.reverseHotkeyMap[this.state.hotkeyChain.join("")]}),i.a.createElement(I,{items:this.state.data.categoryHierarchy.children,hotkeyMap:this.state.hotkeyMap,hotkeyChain:this.state.hotkeyChain.join(""),initHotkeyMap:this.initHotkeyMap.bind(this),applyTag:this.applyTag.bind(this)}))))}}]),n}(a.Component),R=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){return Object(l.a)(this,n),t.call(this,e)}return Object(d.a)(n,[{key:"render",value:function(){return i.a.createElement("div",{id:"tagging-complete-message"},i.a.createElement("span",{class:"tagging-complete-text"},i.a.createElement("h2",null,"Annotation complete!"),i.a.createElement("p",null,"Thank you for your participation in this project.")))}}]),n}(a.Component);var W=function(){return i.a.createElement(D,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(W,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[21,1,2]]]);
//# sourceMappingURL=main.732a46f7.chunk.js.map